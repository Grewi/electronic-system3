<?php

use system\inst\classes\installItem;
use system\inst\classes\functions;
use system\core\app\app;


define('ENTRANSE', 'install');
define('INDEX', true);
define('ROOT', str_replace('\\', '/', dirname(__DIR__)));
define('SYSTEM', ROOT . '/system');
define('INST', SYSTEM . '/inst');
define('ITEMS', INST . '/items');
define('INSTALL_INI', ROOT . '/install.ini');
define('INSTALL_JSON', ROOT . '/install.json');
require_once SYSTEM . '/system.php';
$app = app::app();

functions::parametrs();

if (empty($app->item->name)) {
    echo 'Необходимо указать компонент установки.' . PHP_EOL;
    echo ('Для установки доступны: ' . PHP_EOL);
    functions::infoListItem();
    exit();
}

if ($app->item->name == 'all') {
    $installIni = functions::parseInstallIni();
    $data = [];
    if (file_exists(INSTALL_JSON)) {
        $data = json_decode(file_get_contents(INSTALL_JSON), true);
    }

    foreach (functions::listItemsForInstall() as $a => $i) {
        $app->item->params->app = $a;
        $app->item->name = $a;
        functions::constantFilesItem();
        foreach ($i as $aa => $ii) {
            $app->item->params->{$aa} = $ii;
        }
        var_dump($app);
        // new installItem();
    }

} else {
    $iDir = ITEMS . '/' . $app->item->name;
    functions::constantFilesItem();

    if (file_exists($iDir)) {

        new installItem();
    } else {
        echo ('Проверьте параметры запроса. ' . $app->item->name . ' не найден!' . PHP_EOL);
        echo ('Для установки доступны: ' . PHP_EOL);
        functions::infoListItem();
        echo ('Для более подробной информации используйте параметр help ' . PHP_EOL);
    }
}
